<div class="example-tree-controls">
  <mat-checkbox [formControl]="wrap">Wrap</mat-checkbox>
  <mat-checkbox [formControl]="multi">Multi</mat-checkbox>
  <mat-checkbox [formControl]="disabled">Disabled</mat-checkbox>
  <mat-checkbox [formControl]="skipDisabled">Skip Disabled</mat-checkbox>

  <mat-form-field subscriptSizing="dynamic" appearance="outline">
    <mat-label>Orientation</mat-label>
    <mat-select [(value)]="orientation">
      <mat-option value="vertical">Vertical</mat-option>
      <mat-option value="horizontal">Horizontal</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field subscriptSizing="dynamic" appearance="outline">
    <mat-label>Selection Strategy</mat-label>
    <mat-select [(value)]="selectionMode">
      <mat-option value="explicit">Explicit</mat-option>
      <mat-option value="follow">Follow</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field subscriptSizing="dynamic" appearance="outline">
    <mat-label>Focus Strategy</mat-label>
    <mat-select [(value)]="focusMode">
      <mat-option value="roving">Roving</mat-option>
      <mat-option value="activedescendant">Active Descendant</mat-option>
    </mat-select>
  </mat-form-field>
</div>

<div class="example-tree-output">
  <strong>Selected Values:</strong> {{ selectedValues().join(', ') || 'None' }}
</div>

<ul
  cdkTree
  class="example-tree"
  [orientation]="orientation"
  [multi]="multi.value"
  [disabled]="disabled.value"
  [selectionMode]="selectionMode"
  [focusMode]="focusMode"
  [wrap]="wrap.value"
  [skipDisabled]="skipDisabled.value"
  [(value)]="selectedValues"
  #tree="cdkTree"
>
  @for (node of treeData; track node) {
    <li
      cdkTreeItem
      class="example-tree-item"
      [value]="node.value"
      [label]="node.label || node.value"
      [disabled]="node.disabled"
      #treeItem="cdkTreeItem"
    >
      <ng-template
        [ngTemplateOutlet]="header"
        [ngTemplateOutletContext]="{treeItem: treeItem, label: node.label}"
      ></ng-template>

      @if (node.children && node.children.length > 0) {
        <div cdkGroup [value]="node.value">
          <ng-template cdkGroupContent>
            @for (node of node.children; track node) {
              <div
                cdkTreeItem
                class="example-tree-item"
                [value]="node.value"
                [label]="node.label || node.value"
                [disabled]="node.disabled"
                #treeItem="cdkTreeItem"
              >
                <ng-template
                  [ngTemplateOutlet]="header"
                  [ngTemplateOutletContext]="{treeItem: treeItem, label: node.label}"
                ></ng-template>

                @if (node.children && node.children.length > 0) {
                  <div cdkGroup [value]="node.value">
                    <ng-template cdkGroupContent>
                      @for (node of node.children; track node) {
                        <div
                          cdkTreeItem
                          class="example-tree-item"
                          [value]="node.value"
                          [label]="node.label || node.value"
                          [disabled]="node.disabled"
                          #treeItem="cdkTreeItem"
                        >
                          <ng-template
                            [ngTemplateOutlet]="header"
                            [ngTemplateOutletContext]="{treeItem: treeItem, label: node.label}"
                          ></ng-template>
                        </div>
                      }
                    </ng-template>
                  </div>
                }
              </div>
            }
          </ng-template>
        </div>
      }
    </li>
  }
  <!-- Ideal way of tree item creation -->
  <!-- @for (node of treeData; track node) {
      <ng-template [ngTemplateOutlet]="nodeTmpl"
                   [ngTemplateOutletContext]="{node: node, parent: tree, tree: tree}"></ng-template>
    } -->
</ul>

<ng-template #header let-item="treeItem" let-label="label">
  <div
    class="example-tree-item-content"
    [style.paddingLeft.px]="((item.pattern.level() ?? 1) - 1) * 24"
  >
    <mat-icon class="example-tree-item-icon" aria-hidden="true">
      @if (item.pattern.expandable()) {
        {{ item.pattern.expanded() ? 'expand_less' : 'expand_more' }}
      }
    </mat-icon>
    {{ label }}
  </div>
</ng-template>

<!-- Need to solve content query and DI issue with ng-template -->
<ng-template #nodeTmpl let-node="node">
  <li
    cdkTreeItem
    [value]="node.value"
    [label]="node.label || node.value"
    [disabled]="node.disabled"
    #treeItem="cdkTreeItem"
  >
    <ng-template
      [ngTemplateOutlet]="header"
      [ngTemplateOutletContext]="{treeItem: treeItem, label: node.label}"
    ></ng-template>

    @if (node.children && node.children.length > 0) {
      <div cdkGroup [value]="node.value">
        @for (child of node.children; track child) {
          <ng-template
            [ngTemplateOutlet]="nodeTmpl"
            [ngTemplateOutletContext]="{node: child}"
          ></ng-template>
        }
      </div>
    }
  </li>
</ng-template>
