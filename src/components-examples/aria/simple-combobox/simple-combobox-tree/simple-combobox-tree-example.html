<div class="example-combobox-container">
  <div #origin class="example-combobox-input-container">
    <span class="material-symbols-outlined example-icon example-search-icon">search</span>
    <input
      ngCombobox
      #combobox="ngCombobox"
      class="example-combobox-input"
      placeholder="Search..."
      [(value)]="searchString"
      [(expanded)]="popupExpanded"
    />
  </div>

  <ng-template
    [cdkConnectedOverlay]="{origin, usePopover: 'inline', matchWidth: true}"
    [cdkConnectedOverlayOpen]="true"
    [cdkConnectedOverlayDisableClose]="true"
  >
    <ng-template ngComboboxPopup [combobox]="combobox" popupType="tree">
      <ul
        ngTree
        ngComboboxWidget
        class="example-tree example-popup"
        focusMode="activedescendant"
        selectionMode="explicit"
        [(values)]="selectedValues"
        (click)="onCommit()"
        (keydown.enter)="onCommit()"
        #tree="ngTree"
      >
        <ng-template
          [ngTemplateOutlet]="treeNodes"
          [ngTemplateOutletContext]="{nodes: filteredGroups(), parent: tree}"
        />
      </ul>
    </ng-template>
  </ng-template>
</div>

<ng-template #treeNodes let-nodes="nodes" let-parent="parent">
  @for (node of nodes; track node.name) {
    <li
      ngTreeItem
      [parent]="parent"
      [value]="node"
      [label]="node.name"
      [(expanded)]="node.expanded"
      #treeItem="ngTreeItem"
      class="example-tree-item example-selectable example-stateful"
    >
      <span aria-hidden="true" class="material-symbols-outlined example-parent-icon example-icon">
        {{node.children ? 'chevron_right' : ''}}
      </span>
      {{ node.name }}
      <span aria-hidden="true" class="material-symbols-outlined example-selected-icon example-icon">
        check
      </span>
    </li>
    @if (node.children) {
      <ul role="group">
        <ng-template ngTreeItemGroup [ownedBy]="treeItem" #group="ngTreeItemGroup">
          <ng-template
            [ngTemplateOutlet]="treeNodes"
            [ngTemplateOutletContext]="{nodes: node.children, parent: group}"
          />
        </ng-template>
      </ul>
    }
  }
</ng-template>
